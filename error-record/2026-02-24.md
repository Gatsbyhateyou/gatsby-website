# 错误记录 2026-02-24

## 第 1 条：Flair 光标跟随效果在首页/Diary 均不显示

- **场景/问题**：将 CodePen 的 flair 光标跟随（鼠标移动时弹出小图并下落）接到首页，后改接到 diary 页，用户始终看不到效果。
- **表现**：GSAP 已加载、9 张 flair 图 200、MutationObserver 能监听到样式更新，但界面上看不到任何 flair 出现；排除移动端模拟、移动距离不足、z-index 与强制可见样式后仍无效。
- **原因**：未在用户环境里复现到根因；可能包括：该环境下 position fixed + GSAP 动画的合成/渲染异常、或与站点其它层（halo/渐变）的 stacking context 导致绘制不可见。
- **改正方式**：从 index.html 与 diary.html 中移除 flair 相关 HTML、样式与脚本，避免无效代码残留。
- **教训**：同类“跟随光标 + 多图动画”效果若在目标环境始终不显示，可考虑改为 **Canvas 绘制**（如后续采用的 emoji 粒子）或单独建一个最小复现页（仅 flair + GSAP）再排查环境差异；不要在同一页反复堆 z-index/visibility 期望“强制可见”。

---

## 第 2 条：首页 emoji 粒子层点击无法暂停动画

- **场景/问题**：把 practice-1-b 的 emoji 粒子效果接到首页后，单击屏幕无法像原页一样暂停/恢复动画。
- **表现**：点击页面无反应，动画一直播放。
- **原因**：emoji 画布层 `z-index: 0`，主内容区 `z-index: 1`，点击事件被上层主内容接收，画布收不到 `pointerup`。
- **改正方式**：不再在 canvas 上监听，改为在 `document` 上监听 `pointerup`；若点击目标为 `a, button, [role=button], input, textarea, .idea-bin-trigger` 则直接 return，否则切换 timeline 的 `timeScale`（0/1）。emoji 层保持 `pointer-events: none`。
- **教训**：当“需要点击交互的层”在视觉上位于内容下方时，用 **document 级监听 + 排除可点击元素**，既保证链接/按钮正常，又能在空白处触发控制逻辑。

---

## 第 3 条：首页控制台报 GTM 加载失败 (ERR_CONNECTION_CLOSED)

- **场景/问题**：首页打开后控制台出现 `Failed to load resource: net::ERR_CONNECTION_CLOSED`（gtm.js），用户反馈“首页出问题”。
- **表现**：控制台红色报错，指向 `www.googletagmanager.com/gtag/js?id=G-xxx`。
- **原因**：网络或环境无法访问 Google（防火墙/VPN/地区限制等），脚本请求被关闭；与本站代码逻辑无关，但未做加载失败处理时可能留下半初始化的 gtag。
- **改正方式**：在 `public/analytics-loader.js` 中：先创建 dataLayer 与 gtag 占位，再创建 script 标签；在 script 的 `onload` 中才执行 `gtag('js', ...)` 与 `gtag('config', gaId)`；为 script 添加 `onerror` 静默处理。
- **教训**：统计脚本等依赖外网的可选资源，应 **onload 再初始化、onerror 静默**，避免加载失败时继续调用 gtag 或让用户误以为整站异常；控制台仍可能显示一条网络错误，属预期。
