---
name: cleanup-unused
description: 版本大更新后清理用不到的文件、图片与死代码/注释块。Use when the user says 清理、跑一遍清理检查、删掉没用的、清理死代码、清理未引用的文件、版本更新后清理. 先扫出「疑似可删」清单，用户确认后再执行删除，绝不未经确认就删。
---

# 清理用不到的文件与死代码

在**版本大更新之后**，用户手动跑一遍清理检查：找出未被引用的文件/资源、以及死代码与大块注释，列出清单供用户确认，**用户明确说「这些可以删」后再执行删除**。

## 适用范围（当前）

仅服务**当前静态站（gatsby-website）**。入口与引用规则见 [references/project-scope.md](references/project-scope.md)。后续可再做通用版。

## 三步流程（必须按顺序）

### 阶段 1：扫出候选清单

1. 读取 [references/project-scope.md](references/project-scope.md)，确认入口与「视为被引用」的规则。
2. **文件/资源**：从所有入口 HTML 出发，收集所有站内引用路径（href、src、url() 等）；再扫描 public/ 及根目录相关资源目录，列出**未被上述引用且不在排除列表**中的文件。每项注明理由（如「未被任何入口或已引用文件引用」）。
3. **死代码/注释块**：在已引用的 JS/CSS 中识别未被调用的函数或未使用的样式、以及连续多行（建议 ≥5 行）被注释掉的代码块，列入清单并注明所在文件与行号或片段。
4. 输出一份**结构化清单**（表格或列表），分两类：**疑似未引用文件**、**疑似死代码/可删注释块**。每项含：路径或位置、简要理由。不执行任何删除。

### 阶段 2：用户确认

1. 将清单呈现给用户，请用户逐项或分批勾选「可删」或「保留」。
2. 对用户不确定的项，可再次说明引用关系或保留理由。
3. 仅当用户**明确列出或勾选「这些可以删」**后，才进入阶段 3。若用户说「先不删」或「只删某几项」，只对用户指定的项执行删除。

### 阶段 3：执行删除

1. 仅对用户在阶段 2 中**确认可删**的项执行删除：
   - **文件**：使用删除工具或 `git rm`/文件删除接口删除文件。
   - **死代码/注释块**：在对应文件中用编辑工具删除指定片段，不破坏周围有效代码。
2. 删除后给出**简要小结**：已删除哪些、保留哪些（若用户要求保留部分）。
3. 建议用户：若担心误删，可先提交一次 git 或备份，再执行删除。

## 禁止

- **未经用户明确确认就删除任何内容**。
- 对「可能仍被动态引用」或「构建/脚本依赖」存疑时，将该类项标为「待用户确认」而非直接列入可删。

## 触发示例

- 「版本更新完了，帮我清一下没用到的文件和死代码」
- 「跑一遍清理检查」
- 「把那些旧文件/死代码清一清，先给我清单」
